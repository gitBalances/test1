<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<!--指定公共引入页面,引入静态资源-->
<head th:include="front/common/common_static">
</head>

<body>

<!--引入公有banner导航-->
<div th:include="front/common/common_banner::banner_"></div>
<!--引入公有的登录注册弹出框-->
<div th:include="front/common/common_login_signup::login_signup_"></div>

<!-- banner -->
<div class="agile_inner_banner_info">
    <h2>数据展示</h2>
    <p>业内行情了如指掌</p>
</div>

<!-- 图表数据 -->
<div class="wrap-data" style="height: 500px">
    <div class="container-fluid">
        <div id="test" class="chart" style="height: 300px;"></div>
    </div>
</div>


<!-- footer -->
<div class="footer">
    <div class="container">
        <div class="w3_agile_footer_grids">
            <div class="col-md-4 w3_agile_footer_grid">
                <h3>Latest Tweets</h3>
                <ul class="agile_footer_grid_list">
                    <li><i class="fa fa-twitter" aria-hidden="true"></i>Nam libero tempore, cum soluta nobis est
                        eligendi optio cumque nihil
                        impedit. <span>1 day ago</span></li>
                    <li><i class="fa fa-twitter" aria-hidden="true"></i>Itaque earum rerum hic tenetur a sapiente
                        delectus <a href="mailto:info@mail.com">info@mail.com</a> cumque nihil impedit.
                        <span>2 days ago</span></li>
                </ul>
            </div>
            <div class="col-md-4 w3_agile_footer_grid">
                <h3>Navigation</h3>
                <ul class="agileits_w3layouts_footer_grid_list">
                    <li><i class="fa fa-angle-double-right" aria-hidden="true"></i><a href="/">首页</a></li>
                    <li><i class="fa fa-angle-double-right" aria-hidden="true"></i><a href="/materials">大宗原料</a></li>
                    <li><i class="fa fa-angle-double-right" aria-hidden="true"></i><a href="/quotation">行情</a></li>
                    <li><i class="fa fa-angle-double-right" aria-hidden="true"></i><a href="/map">产业地图</a></li>
                </ul>
            </div>
            <div class="col-md-4 w3_agile_footer_grid">
                <h3>2019年公司计划</h3>
                <div class="w3_agileits_footer_grid_left">
                    <a href="#" data-toggle="modal" data-target="#myModal">
                        <img src="images/f1.jpg" alt=" " class="img-responsive"/>
                    </a>
                </div>
                <div class="w3_agileits_footer_grid_left">
                    <a href="#" data-toggle="modal" data-target="#myModal">
                        <img src="images/f2.jpg" alt=" " class="img-responsive"/>
                    </a>
                </div>
                <div class="w3_agileits_footer_grid_left">
                    <a href="#" data-toggle="modal" data-target="#myModal">
                        <img src="images/f4.jpg" alt=" " class="img-responsive"/>
                    </a>
                </div>
                <div class="w3_agileits_footer_grid_left">
                    <a href="#" data-toggle="modal" data-target="#myModal">
                        <img src="images/f3.jpg" alt=" " class="img-responsive"/>
                    </a>
                </div>
                <div class="w3_agileits_footer_grid_left">
                    <a href="#" data-toggle="modal" data-target="#myModal">
                        <img src="images/f1.jpg" alt=" " class="img-responsive"/>
                    </a>
                </div>
                <div class="w3_agileits_footer_grid_left">
                    <a href="#" data-toggle="modal" data-target="#myModal">
                        <img src="images/f2.jpg" alt=" " class="img-responsive"/>
                    </a>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="w3ls_address_mail_footer_grids">
            <div class="col-md-4 w3ls_footer_grid_left">
                <div class="wthree_footer_grid_left">
                    <i class="fa fa-map-marker" aria-hidden="true"></i>
                </div>
                <p>3481 Melrose Place, Beverly Hills, <span>New York City 90210.</span></p>
            </div>
            <div class="col-md-4 w3ls_footer_grid_left">
                <div class="wthree_footer_grid_left">
                    <i class="fa fa-phone" aria-hidden="true"></i>
                </div>
                <p>+(0086)021-59830697 <span>+(0086)021-59830697</span></p>
            </div>
            <div class="col-md-4 w3ls_footer_grid_left">
                <div class="wthree_footer_grid_left">
                    <i class="fa fa-envelope-o" aria-hidden="true"></i>
                </div>
                <p><a href="mailto:info@example.com">zs@chinacarbon-al.com</a>
                    <span><a href="mailto:info@example.com">zs@chinacarbon-al.com</a></span></p>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<!-- //footer -->

<script src="js/bootstrap.js"></script>
<script>
    /*声明创建货品类型数组*/
    var goodsType = ['PetroleumCoke', 'CalcinedCoke', 'MAsphalt', 'Anode'];
    /*声明创建ECharts对象*/
    var myChart = echarts.init(document.getElementById("test"));

    myChartDefalut();

    var goodsTypeIndex = null;
    var selectOrder = 0;
    var ChartType = 0;
    var thisChartType = null;

    function initDefaultChartType() {
        return "line";
    }

    // function setChartType(chartType) {
    //     if (chartType === 1 && chartType !== ChartType) {
    //         ChartType = chartType;
    //         thisChartType = "line"; //曲线图
    //         if (goodsTypeIndex == null) {
    //             alert("请先选择一种货品进行查看.");
    //             return;
    //         }
    //         getAllGoodsByType(myChart, thisChartType, goodsTypeIndex, null, null, selectOrder);
    //
    //     }
    //     if (chartType === 2 && chartType !== ChartType) {
    //         ChartType = chartType;
    //         thisChartType = "bar" //柱状图
    //         if (goodsTypeIndex == null) {
    //             alert("请先选择一种货品进行查看.");
    //             return;
    //         }
    //         getAllGoodsByType(myChart, thisChartType, goodsTypeIndex, null, null, selectOrder);
    //     }
    // }

    /*根据传入的货品数组的下标来查询指定下标的货品类型*/

    //默认调用下标0的货品数组下标 在底部默认开启调用
    function setGoodsType(index) {
        goodsTypeIndex = index;
        getAllGoodsByType(myChart, thisChartType, index, $("#memberLevel").val(), null, selectOrder);
        myChartDefalut();
        // getAllGoodsByType(myChart,index, null, null, selectOrder);
    }

    //初始化图表 -> 默认数据
    function myChartDefalut() {
        myChart.setOption({
            legend:{data: []},
            tooltip: {
                trigger: 'axis',
                // axisPointer: {
                //     type: 'cross',
                //     label: {
                //         backgroundColor: '#283b56'
                //     }
                // }
            },
            dataset: {
                source: {},
                dimensions: []
            },
            xAxis: [
                {
                    type: 'category', gridIndex: 0, axisLabel: {
                        rotate: 50, interval: 0
                    }
                }
            ],
            yAxis:
                [
                    {type: 'value', gridIndex: 0}
                ],
            grid:[
                {bottom: '0'},
                {top: '50px'}

            ],
            series: [{
                name: '总交易',
                data: [1200, 932, 800, 1000, 1290, 1330, 1320],
                type: 'line'
            }]

        });
    }


    /*设置选取的货品数据时间排序方式,asc,desc*/
    // function setOrderType(order) {
    //     getAllGoodsByType(myChart, thisChartType, goodsType[goodsTypeIndex], null, null, order);
    // }


    /*默认获取石油焦信息,可按需更改*/
    // getAllGoodsByType(myChart,thisChartType,0,1,null,null,);

    //除了根据会员等级查询,还应该根据用户点击显示几个月,几年的按钮进行展示(timeInteval)
    /*myChart:图表对象,goodsType:货品类型,memberLevel:用户等级,timeInterval:时间区间,selectOrder:查询排序*/
    function getAllGoodsByType(myChart, thisChartType, index, memberLevel, timeInterval, selectOrder) {
        if (thisChartType == null) {
            thisChartType = initDefaultChartType();
        }


        // /*获取json数据中的某一个字段*/
        // /*获取json数据中的某一个字段*/
        var newJson = null;
        //获取展示形式如:
        var newJson2 = null;
        var newArr = [];
        // var companys = null;
        var companys = [];
        var today_price = null; //今日价格汇总
        var createTimes = null; //创建时间
        var allData = null;
        var option = null;
        var url = "/goods/" + this.goodsType[index] + "/" + "testselectSelective";
        // alert("memberLevel:"+memberLevel);
        // var companys = null;
        // var url = "/goods/"+goodsType+"/"+"selectAll";
        myChart.showLoading();
        $.ajax({
            // url: "/petroleumCoke/selectAll", //获取所有石油焦数据list
            url: url, //按需获取goods数据
            data: {'order': selectOrder, "member_level":memberLevel},
            dataType: "json",
            // contentType:"application/json;charset=UTF-8",
            type: "post",
            success: function (data) {

                myChart.hideLoading(); //数据data加载后隐藏loading

                // alert(JSON.stringify(data.petroleumCokes)); OK
                // petroleumCokesJson = JSON.stringify(data); OK
                //石油焦json数据
                // petroleumCokesJson = data; //OK
                // console.log("JSON.stringify(data):" + JSON.stringify(data));
                // console.log(">>data:" + JSON.stringify(data));
                allData = data;
                //获取公司字段,获取公司数组,去重
                companys = getParamValues("company", data).delDuplicate();
                // console.log(">>companys:"+companys);
                // company[0]的所有历史价格
                // 根据字段获取指定公司的today_price数组
                price0 = getParamValuesByCname("today_price", data, "company", companys[0]);
                // console.log("price0:" + price0);
                //根据公司名查询历史价格 -> (数组)
                /*newJson:{'华联石化':[2323,5321],'海油石化':[3000,2311],'昌邑石化':[2703,1688]}*/
                newJson = getJsonResult("today_price", data, "company", companys);
                // console.log("newJson:" + newJson);
                today_price = getParamValues("today_price", data); //OK
                // console.log(today_price); //OK
                // alert(today_price); //OK
                createTimes = getParamValues("create_time", data).delDuplicate();

                newJson2 = getJsonResultPro("today_price", data, "company", companys, "createTimes");
                // console.log("newJson2:" + newJson2);

                //
                newArr = getArrayResultPro("today_price", data, "company", companys, "createTime", "create_time");
                // console.log("newArr:" + newArr);
                var seriesContent = getSeriesContent(companys.length, thisChartType, "row");
                // console.log("seriesContent:"+JSON.stringify(seriesContent));
                //获取时间和公司数组填入维度
                var dimensions = twoArrayToOne(companys, "createTime");
                // console.log("dimensions:"+dimensions);

                //legendData 展示公司名称数组,在切换其它货品信息时,不能有效地获取companys
                var legendData = companys.map(String);

                // alert("legendData:"+JSON.stringify(legendData));
                // alert("newArr:"+JSON.stringify(newArr));
                // alert("dimensions:"+JSON.stringify(dimensions));
                // alert("seriesContent:"+JSON.stringify(seriesContent));

                option = {
                    legend: {
                        data: legendData,
                        y:'0px',
                    },

                    tooltip: {trigger: 'axis',},
                    // dataset:{
                    //     source:
                    //     newJson2
                    // },
                    toolbox: { //切换曲线/柱状图
                        feature: {
                            dataView: {show: false, readOnly: false}, //文本数据,关闭
                            magicType: {show: true, type: ['line', 'bar']}, //展示类型切换
                            restore: {show: true},
                            saveAsImage: {show: true},
                            dataZoom: { //区域缩放
                                yAxisIndex: false
                            }
                        },
                        y:'20%',

                    },
                    dataZoom: { //时间轴拖动
                        show: true,
                        realtime: true,
                        y: 360,
                        height: 20,
                        start: 0,
                        end: 1000
                    },
                    dataset: {
                        //Array形式
                        source: newArr,
                        dimensions: dimensions
                    },
                    xAxis: [
                        {
                            type: 'category', gridIndex: 0, axisLabel: {
                                rotate: 50, interval: 0
                            }
                        }
                    ],
                    yAxis:
                        [
                            {type: 'value', gridIndex: 0}
                            // {gridIndex: 0},
                            //
                            // {
                            //     // type:'value',
                            //     // gridIndex: 0, axisLabel: {
                            //     //     rotate: 0, interval: 0,
                            //     //     // formatter: function (value) {
                            //     //     //     return value + '元'
                            //     //     // }
                            //     // }
                            // },
                            // {gridIndex: 1}
                        ],
                    grid:
                        [
                            // {bottom: '55%'},
                            // {top: '55%'}
                            {
                                y:'30%',
                                y2:'40%',
                            }
                        ],
                    series:
                    seriesContent
                };
                myChart.setOption(option);
            },
            // error: function () {
            //
            //     alert("error");
            //     myChart.hideLoading(); //TODO 设定用户没登录的模板图表 , 数据data加载后隐藏loading
            //     var optionExample = {
            //         legend: {
            //             data: ['石化a示例', '石化b示例', '石化c示例']
            //         },
            //         tooltip: {trigger: 'axis',},
            //         // dataset:{
            //         //     source:
            //         //     newJson2
            //         // },
            //         dataset: {
            //             // 提供一份数据。
            //             source: [
            //                 ['product', '2015', '2016', '2017'],
            //                 ['Matcha Latte', 43.3, 85.8, 93.7],
            //                 ['Milk Tea', 83.1, 73.4, 55.1],
            //                 ['Cheese Cocoa', 86.4, 65.2, 82.5],
            //                 ['Walnut Brownie', 72.4, 53.9, 39.1]
            //             ]
            //
            //         },
            //         xAxis: [
            //             {
            //                 type: 'category', gridIndex: 0, axisLabel: {
            //                     rotate: 50, interval: 0
            //                 }
            //             }
            //             // {gridIndex: 0},
            //             // {
            //             //     type: 'category',
            //             //
            //             //     // data:createTimes,
            //             //     // axisLabel: {
            //             //     //    rotate: 50, interval: 0
            //             //     // }
            //             // },
            //             // {type: 'category', gridIndex: 1}
            //         ],
            //         yAxis:
            //             [
            //                 {type: 'value', gridIndex: 0}
            //                 // {gridIndex: 0},
            //                 //
            //                 // {
            //                 //     // type:'value',
            //                 //     // gridIndex: 0, axisLabel: {
            //                 //     //     rotate: 0, interval: 0,
            //                 //     //     // formatter: function (value) {
            //                 //     //     //     return value + '元'
            //                 //     //     // }
            //                 //     // }
            //                 // },
            //                 // {gridIndex: 1}
            //             ],
            //         grid:
            //             [
            //                 {bottom: '55%'},
            //                 {top: '55%'}
            //             ],
            //         series:
            //             [
            //                 {type: 'line'},
            //                 {type: 'line'},
            //                 {type: 'line'}
            //             ]
            //     };
            //     myChart.setOption(optionExample);
            // }
        });


    }

    setGoodsType(0);
</script>

</body>

</html>
